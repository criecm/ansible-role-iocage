---
jail_ip6s: '{{ onejail.ip6 | default("") | regex_replace(",?([^\|]+\|)"," ") }}'
jail_ips: '{{ jail_ip6s }}{{ onejail.ip4 | default("") | regex_replace(",?([a-z0-9\.]+\|)"," ") }}'

jail_resolvers: '{% for ns in resolvers if not ns.network == "0.0.0.0/0" %}{% for i in jail_ips.split(" ") %}{% if i | ipaddr(ns.network) %}nameserver {{ ns.ip }};{% endif %}{% endfor %}{% endfor %}'

jail_domain: '{{ onejail.hostname | default("host.local") | regex_replace("^[^\.]+\.","") }}'

jail_search_domains: '{% if search_domains %}{% for sd in search_domains %}{% if jail_ips.split(" ") | ipaddr(sd.network) %} {{ sd.domain }}{% endif %}{% endfor %}{% endif %}'

jail_resolver: '{{ jail_resolvers }}{{ jail_search_domains | default(jail_domain) }}'
#search {{ onejail.search_domains | default(jail_search_domains) }};'

jail_defaults:
  ip6: 'none'
  ip4: 'none'
  name: ''
  hostname: ''
  fstab: ''
  template: 'no'
  resolver: '{% if "resolver" in onejail and onejail.resolver == "auto" %}{{ jail_resolver }}{% endif %}'

jail: '{{ jail_defaults | combine(onejail) }}'
